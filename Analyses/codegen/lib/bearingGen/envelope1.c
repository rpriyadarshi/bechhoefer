/*
 * Trial License - for use to evaluate programs for possible purchase as
 * an end-user only.
 * File: envelope1.c
 *
 * MATLAB Coder version            : 4.0
 * C/C++ source code generated on  : 29-Jul-2018 17:50:29
 */

/* Include Files */
#include "rt_nonfinite.h"
#include "bearingGen.h"
#include "envelope1.h"
#include "abs.h"
#include "filter.h"
#include "exp.h"

/* Function Definitions */

/*
 * ENVELOPE1 Summary of this function goes here
 *    [env,dty] = envelope1(data,dt,nfilt,lowf,highf);
 * Inputs:
 *    data:   data vector, time domain
 *    dt:     sampling time interval
 *    nfilt:  size of filter for low pass filtering
 *    lowf:   low frequency limit of bandpass filter
 *    highf:  high frequency limit of bandpass filter
 * Outputs:
 *    env:    Envelope of data
 *    dty:    decimated sample rate
 * Arguments    : const double data[146484]
 *                double env[12197]
 *                double *dty
 * Return Type  : void
 */
void envelope1(const double data[146484], double env[12197], double *dty)
{
  int i;
  static creal_T dcv0[146484];
  static const double dv0[129] = { 0.00036861527470261594,
    0.00039335476297946796, 0.0004180940372845758, 0.00044263712730897723,
    0.00046629372143374852, 0.00048785639819432994, 0.00050560144068817849,
    0.000517314554612083, 0.000520342005716636, 0.00051166684455042084,
    0.00048800902048050756, 0.0004459473292516705, 0.00038206031525140255,
    0.00029308248720752282, 0.00017607152907041641, 2.8581619166579041E-5,
    -0.0001511624694751009, -0.000364096109569761, -0.00061015615925786356,
    -0.00088813862899514949, -0.0011955782021079633, -0.0015286547637556258,
    -0.0018821315568845929, -0.002249328893768136, -0.0026221365231503687,
    -0.0029910668053995007, -0.003345349804787714, -0.0036730702956508116,
    -0.00396134552687636, -0.0041965414278299735, -0.0043645238002949331,
    -0.0044509399571722461, -0.0044415252706436811, -0.00432242820961563,
    -0.004080546705370924, -0.0037038681089688846, -0.0031818046135359272,
    -0.002505515824040887, -0.0016682101762103988, -0.00066541713922212392,
    0.00050477741761500159, 0.0018415396628493172, 0.0033411461701076755,
    0.0049968973199927755, 0.00679908967078815, 0.0087350499357975279,
    0.01078923181473433, 0.012943375475855877, 0.015176728010343317,
    0.017466321717716324, 0.019787305667938827, 0.022113324658586286,
    0.024416938478473139, 0.026670073334226253, 0.028844496421601574,
    0.03091230395268953, 0.032846412502348835, 0.034621043325520712,
    0.036212189328861263, 0.037598054656598358, 0.038759457366671073,
    0.039680186417930724, 0.040347305145512845, 0.040751394547035434,
    0.040886731009780304, 0.040751394547035434, 0.040347305145512845,
    0.039680186417930724, 0.038759457366671073, 0.037598054656598358,
    0.036212189328861263, 0.034621043325520712, 0.032846412502348835,
    0.03091230395268953, 0.028844496421601574, 0.026670073334226253,
    0.024416938478473139, 0.022113324658586286, 0.019787305667938827,
    0.017466321717716324, 0.015176728010343317, 0.012943375475855877,
    0.01078923181473433, 0.0087350499357975279, 0.00679908967078815,
    0.0049968973199927755, 0.0033411461701076755, 0.0018415396628493172,
    0.00050477741761500159, -0.00066541713922212392, -0.0016682101762103988,
    -0.002505515824040887, -0.0031818046135359272, -0.0037038681089688846,
    -0.004080546705370924, -0.00432242820961563, -0.0044415252706436811,
    -0.0044509399571722461, -0.0043645238002949331, -0.0041965414278299735,
    -0.00396134552687636, -0.0036730702956508116, -0.003345349804787714,
    -0.0029910668053995007, -0.0026221365231503687, -0.002249328893768136,
    -0.0018821315568845929, -0.0015286547637556258, -0.0011955782021079633,
    -0.00088813862899514949, -0.00061015615925786356, -0.000364096109569761,
    -0.0001511624694751009, 2.8581619166579041E-5, 0.00017607152907041641,
    0.00029308248720752282, 0.00038206031525140255, 0.0004459473292516705,
    0.00048800902048050756, 0.00051166684455042084, 0.000520342005716636,
    0.000517314554612083, 0.00050560144068817849, 0.00048785639819432994,
    0.00046629372143374852, 0.00044263712730897723, 0.0004180940372845758,
    0.00039335476297946796, 0.00036861527470261594 };

  static creal_T b_data[146484];
  static creal_T dcv1[12197];
  for (i = 0; i < 146484; i++) {
    dcv0[i].re = -0.0;
    dcv0[i].im = (double)i * -0.38603989353524121;
  }

  b_exp(dcv0);
  for (i = 0; i < 146484; i++) {
    b_data[i].re = data[i] * dcv0[i].re;
    b_data[i].im = data[i] * dcv0[i].im;
  }

  filter(dv0, b_data, dcv0);
  for (i = 0; i < 12197; i++) {
    dcv1[i] = dcv0[128 + 12 * i];
  }

  b_abs(dcv1, env);

  /*  crop first nfilt elements */
  *dty = 0.0002457606291472106;
}

/*
 * File trailer for envelope1.c
 *
 * [EOF]
 */
